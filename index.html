<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AmitXBhai Code Set-up Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* 💅 CSS styles (scroll up for full design) */
  </style>
</head>
<body>

<div class="box" id="loginSection">
  <h2>🔐 Login</h2>
  <input type="text" id="usernameInput" placeholder="Enter your name..." />
  <button onclick="saveLogin()">🚪 Login</button>
</div>

<div class="box" id="toolSection" style="display:none;">
  <div style="display: flex; justify-content: space-between; align-items: center; gap: 10px; margin-bottom: 10px;">
    <div><b>👤 User:</b> <span id="usernameShow"></span></div>
    <div>
      <button onclick="startSaveList()" class="btn-list">📋 List</button>
      <button onclick="startMonoMode()" class="btn-mono">💠 Mono</button>
    </div>
  </div>

  <div class="code-center">
    <input type="text" id="codeInput" placeholder="Enter your code">
    <button onclick="insertCode()" class="btn-save">💾 Save Code</button>
  </div>

  <input type="text" id="dateInput" placeholder="🗓 Enter Date (e.g., 15 June)">
  <textarea id="listInput" rows="6" placeholder="📄 Paste your list..."></textarea>
  <button id="confirmBtn" onclick="saveList()" class="btn-confirm">💾 Confirm Save</button>

  <textarea id="monoInput" rows="6" placeholder="🔤 Paste mono list (codes)..."></textarea>
  <button id="monoRunBtn" onclick="runMono()" class="btn-mono">⚙️ Convert Mono</button>
  <div id="monoResult" class="output"></div>
  <button id="copyMono" class="btn-copy" onclick="copyMonoResult()">📋 Copy Mono</button>

  <div id="result" class="output"></div>
  <button id="copyBtn" class="btn-copy" onclick="copyResult()">📋 Copy</button>
</div>

<div class="toast" id="toast"></div>

<script>
  let userData = { date: '', list: [], nextIndex: 0 };

  function showToast(msg, color = "#00c853", reload = false, withLoader = false) {
    const toast = document.getElementById("toast");
    toast.innerHTML = withLoader ? `<div>${msg}</div><div class="loader"></div>` : msg;
    toast.style.background = color;
    toast.style.display = "block";
    setTimeout(() => {
      toast.style.display = "none";
      if (reload) location.reload();
    }, withLoader ? 2000 : 1500);
  }

  function saveLogin() {
    const username = document.getElementById("usernameInput").value.trim();
    if (!username) return showToast("❌ Username required!", "#ff1744");
    localStorage.setItem("amit_user_name", username);
    showToast("✅ Login Saved!", "#00c853", true);
  }

  function startSaveList() {
    document.getElementById("dateInput").style.display = "block";
    document.getElementById("listInput").style.display = "block";
    document.getElementById("confirmBtn").style.display = "inline-block";
    showToast("📋 Now enter date and list...");
  }

  function saveList() {
    const date = document.getElementById("dateInput").value.trim();
    const lines = document.getElementById("listInput").value.trim().split("\n");

    if (!date || lines.length === 0) {
      showToast("❌ Date OR List missing!", "#ff1744");
      return;
    }

    let cleaned = [];
    for (let line of lines) {
      line = line.trim();
      if (!line) continue;
      let parts = line.split(/\s+/);
      let serial = parseInt(parts[0]);
      if (!isNaN(serial)) {
        if (line.toLowerCase().includes("del")) {
          cleaned.push({ serial, value: "deleted" });
        } else {
          cleaned.push({ serial, value: parts[parts.length - 1] });
        }
      }
    }

    userData = { date, list: cleaned, nextIndex: 0 };
    localStorage.setItem("amit_user_data", JSON.stringify(userData));
    showToast("✅ List saved!", "#00c853", true, true);
  }

  function insertCode() {
    const val = document.getElementById("codeInput").value.trim();
    const [code, number] = val.split(/\s+/);
    if (!code || !number || (code.length !== 8 && code.length !== 9) || isNaN(number)) {
      showToast("❌ Format: ABC123456 2300", "#ff1744");
      return;
    }

    for (let i = userData.nextIndex; i < userData.list.length; i++) {
      let item = userData.list[i];
      if (item.value !== "deleted" && !item.value.includes(" ")) {
        item.value = `${code}   ${number}   ${item.value}`;
        userData.nextIndex = i + 1;
        localStorage.setItem("amit_user_data", JSON.stringify(userData));
        renderShow();
        showToast(`✅ Code saved!`, "#00c853", false, true);
        return;
      }
    }
    showToast("⚠️ No space left to insert.", "#ff9100");
  }

  function renderShow() {
    const saved = localStorage.getItem("amit_user_data");
    const resultEl = document.getElementById("result");
    const copyBtn = document.getElementById("copyBtn");

    if (!saved) {
      resultEl.innerText = "No data.";
      copyBtn.style.display = "none";
      return;
    }

    const data = JSON.parse(saved);
    let output = `**${data.date}**\n\n****\n\n`;
    for (let item of data.list) {
      let val = item.value.replace(/\b([A-Za-z0-9]{8,9})\b/g, "`$1`");
      output += `${item.serial}.   ${val}\n\n`;
    }

    resultEl.innerText = output;
    copyBtn.style.display = "inline-block";
  }

  function copyResult() {
    const text = document.getElementById("result").innerText;
    navigator.clipboard.writeText(text).then(() => {
      showToast("📋 Copied!");
    });
  }

  function startMonoMode() {
    document.getElementById("monoInput").style.display = "block";
    document.getElementById("monoRunBtn").style.display = "inline-block";
    showToast("🔤 Paste your list in mono format...");
  }

  function runMono() {
    const lines = document.getElementById("monoInput").value.trim().split("\n");
    let output = lines
      .map(line => line.trim())
      .filter(line => line)
      .map(line => line.replace(/\b([A-Za-z0-9]{8,9})\b/, "`$1`"))
      .join("\n\n");

    document.getElementById("monoResult").innerText = output;
    document.getElementById("monoResult").style.display = "block";
    document.getElementById("copyMono").style.display = "inline-block";
    showToast("✅ Converted to mono");
  }

  function copyMonoResult() {
    const text = document.getElementById("monoResult").innerText;
    navigator.clipboard.writeText(text).then(() => {
      showToast("📋 Mono Copied!");
    });
  }

  window.onload = () => {
    const savedName = localStorage.getItem("amit_user_name");
    if (!savedName) {
      document.getElementById("loginSection").style.display = "block";
      return;
    }

    document.getElementById("toolSection").style.display = "block";
    document.getElementById("usernameShow").innerText = savedName;

    const saved = localStorage.getItem("amit_user_data");
    if (saved) userData = JSON.parse(saved);

    renderShow();
  };
</script>

</body>
</html>
